<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generador de QR</title>
  <!-- Enlaza la hoja de estilos externa -->
  <link rel="stylesheet" href="styles.css" />
  <!-- Librería QR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
    integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	
</head>
<body>

  <header class="cabecera"><img src="images.png" class="imagen-responsiva" alt=""/>
	</header>
	<h2><center>BIENVENIDOS AL NUEVO SISTEMA DE RECOJO DE CANASTA </center></h2>
	<article class="articulo">Con el fin de brindarles una mejor atención y rapidez en las entregas de nuestras canastas, ponenmos a disposicion, el nuevo sistema de generación de QR, donde usted podra recoger su canasta únicamente presentando su QR generado.</article>

   
	
<div class="container">
  <form id="formQR" class="formulario">
      <div class="campo"><label for="apellido1">Apellido Paterno:</label><input type="text" style="text-transform: uppercase;" id="apellido1"></div>
      <div class="campo"><label for="apellido2">Apellido Materno:</label><input type="text" id="apellido2"></div>
      <div class="campo"><label for="nombres">Nombres:</label><input type="text" id="nombres"></div>
      <div class="campo"><label for="ci">Carnet de identidad:</label><input type="text" id="ci"></div>
      <div class="acciones">
        <button id="boton" type="submit">Generar QR</button>
      </div>
      <div id="errorMsg" class="mensaje-error"></div>
    </form>
    <div id="qrcode"></div>
    <a id="downloadLink" class="btn-descarga" hidden>Descargar QR</a>
  </div>

  <script>
    const form = document.getElementById('formQR');
    const divQR = document.getElementById('qrcode');
    const downloadLink = document.getElementById('downloadLink');
    const err = document.getElementById('errorMsg');
    let qrInstance;

    form.addEventListener('submit', ev => {
      ev.preventDefault();
      err.textContent = "";
      downloadLink.hidden = true;
      divQR.innerHTML = "";

      const ap1 = document.getElementById('apellido1').value.trim();
      const ap2 = document.getElementById('apellido2').value.trim();
      const noms = document.getElementById('nombres').value.trim();
      const ci = document.getElementById('ci').value.trim();

      if (!ap1 || !ap2 || !noms || !ci) {
        err.textContent = "Todos los campos son obligatorios.";
        return;
      }

      const contenido = `${ap1} ${ap2} ${noms} ${ci}`;

      qrInstance = new QRCode(divQR, {
        text: contenido,
        width: 200,
        height: 200,
        colorDark: "#000",
        colorLight: "#fff",
        correctLevel: QRCode.CorrectLevel.H
      });

      // Esperar renderizado QR antes de convertir en imagen
   /*   setTimeout(() => {
        const img = divQR.querySelector("img");
        const dataURL = img?.src ?? divQR.querySelector("canvas")?.toDataURL("image/png");
        if (dataURL) {
          downloadLink.href = dataURL;
          downloadLink.download = "qr_info.png";
          downloadLink.hidden = false;
        }
      }, 300);
    });*/
		
		
		   // Esperar imagen del QR
        setTimeout(() => {
            const img = divQR.querySelector("img");
            const canvas = divQR.querySelector("canvas");
            const dataURL = img?.src ?? canvas?.toDataURL("image/png");

            if (dataURL) {
                downloadLink.hidden = false;

                // Forzar descarga en móviles usando Blob
                downloadLink.onclick = (e) => {
                    e.preventDefault();
                    fetch(dataURL)
                        .then(res => res.blob())
                        .then(blob => {
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement("a");
                            a.href = url;
                            a.download = "qr_info.png";
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        });
                };
            }
        }, 500);
    });


	  <script>
  

  

      // Esperar renderizado QR antes de convertir en imagen
   /*   setTimeout(() => {
        const img = divQR.querySelector("img");
        const dataURL = img?.src ?? divQR.querySelector("canvas")?.toDataURL("image/png");
        if (dataURL) {
          downloadLink.href = dataURL;
          downloadLink.download = "qr_info.png";
          downloadLink.hidden = false;
        }
      }, 300);
    });*/
		
		
		   // Esperar imagen del QR
        
    

</body>
</html>




